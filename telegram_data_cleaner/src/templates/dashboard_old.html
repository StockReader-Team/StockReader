<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>داشبورد مدیریت داده‌های تلگرام</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');

        * {
            font-family: 'Vazirmatn', sans-serif;
        }

        .active-tab {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-50" x-data="dashboardApp()">
    <!-- Header -->
    <header class="gradient-bg shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-chart-line text-3xl text-white"></i>
                    <h1 class="text-2xl font-bold text-white">داشبورد مدیریت داده‌های تلگرام</h1>
                </div>
                <div class="flex items-center gap-4">
                    <button @click="refreshStats()" class="text-white hover:bg-white/20 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-sync-alt" :class="{'fa-spin': loading}"></i>
                        بروزرسانی
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Cards -->
    <div class="container mx-auto px-4 py-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Messages -->
            <div class="stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">کل پیام‌ها</p>
                        <h3 class="text-2xl font-bold mt-1" x-text="stats.messages?.total || 0"></h3>
                    </div>
                    <div class="stat-icon bg-blue-100">
                        <i class="fas fa-envelope text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Dictionaries -->
            <div class="stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">لغت‌نامه‌ها</p>
                        <h3 class="text-2xl font-bold mt-1" x-text="stats.dictionaries?.total_dictionaries || 0"></h3>
                    </div>
                    <div class="stat-icon bg-green-100">
                        <i class="fas fa-book text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Words -->
            <div class="stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">کلمات</p>
                        <h3 class="text-2xl font-bold mt-1" x-text="stats.dictionaries?.total_words || 0"></h3>
                    </div>
                    <div class="stat-icon bg-purple-100">
                        <i class="fas fa-tags text-purple-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Matches -->
            <div class="stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">تطابق‌ها</p>
                        <h3 class="text-2xl font-bold mt-1" x-text="stats.dictionaries?.total_matches || 0"></h3>
                    </div>
                    <div class="stat-icon bg-orange-100">
                        <i class="fas fa-link text-orange-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="container mx-auto px-4">
        <div class="bg-white rounded-lg shadow p-2 flex gap-2 overflow-x-auto">
            <button @click="currentTab = 'overview'"
                    :class="currentTab === 'overview' ? 'active-tab' : 'hover:bg-gray-100'"
                    class="px-6 py-3 rounded-lg font-medium transition whitespace-nowrap">
                <i class="fas fa-home ml-2"></i>
                خانه
            </button>
            <button @click="currentTab = 'dictionaries'"
                    :class="currentTab === 'dictionaries' ? 'active-tab' : 'hover:bg-gray-100'"
                    class="px-6 py-3 rounded-lg font-medium transition whitespace-nowrap">
                <i class="fas fa-book ml-2"></i>
                لغت‌نامه‌ها
            </button>
            <button @click="currentTab = 'words'"
                    :class="currentTab === 'words' ? 'active-tab' : 'hover:bg-gray-100'"
                    class="px-6 py-3 rounded-lg font-medium transition whitespace-nowrap">
                <i class="fas fa-plus-circle ml-2"></i>
                افزودن نماد
            </button>
            <button @click="currentTab = 'import'"
                    :class="currentTab === 'import' ? 'active-tab' : 'hover:bg-gray-100'"
                    class="px-6 py-3 rounded-lg font-medium transition whitespace-nowrap">
                <i class="fas fa-file-import ml-2"></i>
                Import Excel
            </button>
            <button @click="currentTab = 'messages'"
                    :class="currentTab === 'messages' ? 'active-tab' : 'hover:bg-gray-100'"
                    class="px-6 py-3 rounded-lg font-medium transition whitespace-nowrap">
                <i class="fas fa-comments ml-2"></i>
                پیام‌ها
            </button>
        </div>
    </div>

    <!-- Tab Content -->
    <div class="container mx-auto px-4 py-6">
        <!-- Overview Tab -->
        <div x-show="currentTab === 'overview'" class="space-y-6">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">
                    <i class="fas fa-chart-bar ml-2"></i>
                    خوش آمدید!
                </h2>
                <p class="text-gray-600 mb-4">
                    از این داشبورد می‌توانید لغت‌نامه‌های خود را مدیریت کنید، نمادهای بورسی اضافه کنید و پیام‌ها را مشاهده کنید.
                </p>

                <div class="grid md:grid-cols-2 gap-4 mt-6">
                    <div class="border-r-4 border-blue-500 bg-blue-50 p-4 rounded">
                        <h3 class="font-bold text-blue-900 mb-2">
                            <i class="fas fa-lightbulb ml-2"></i>
                            شروع سریع
                        </h3>
                        <ol class="text-sm text-gray-700 space-y-1 list-decimal list-inside">
                            <li>ابتدا یک لغت‌نامه بسازید</li>
                            <li>دسته‌بندی‌های مورد نیاز را اضافه کنید</li>
                            <li>نمادها را از طریق فرم یا Excel وارد کنید</li>
                            <li>پیام‌ها به صورت خودکار تجزیه می‌شوند</li>
                        </ol>
                    </div>

                    <div class="border-r-4 border-green-500 bg-green-50 p-4 rounded">
                        <h3 class="font-bold text-green-900 mb-2">
                            <i class="fas fa-info-circle ml-2"></i>
                            اطلاعات مفید
                        </h3>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li><i class="fas fa-check text-green-600 ml-2"></i>سیستم هر 3 دقیقه پیام‌های جدید را دریافت می‌کند</li>
                            <li><i class="fas fa-check text-green-600 ml-2"></i>تطابق کلمات به صورت خودکار انجام می‌شود</li>
                            <li><i class="fas fa-check text-green-600 ml-2"></i>می‌توانید اطلاعات کامل شرکت‌ها را ذخیره کنید</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Placeholder for Other Tabs -->
        <div x-show="currentTab === 'dictionaries'">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">مدیریت لغت‌نامه‌ها</h2>
                <p class="text-gray-500">در حال توسعه...</p>
            </div>
        </div>

        <div x-show="currentTab === 'words'">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">افزودن نماد</h2>
                <p class="text-gray-500">در حال توسعه...</p>
            </div>
        </div>

        <div x-show="currentTab === 'import'">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">Import از Excel</h2>
                <p class="text-gray-500">در حال توسعه...</p>
            </div>
        </div>

        <div x-show="currentTab === 'messages'">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">پیام‌ها</h2>
                <p class="text-gray-500">در حال توسعه...</p>
            </div>
        </div>
    </div>

    <script>
        function dashboardApp() {
            return {
                currentTab: 'overview',
                loading: false,
                stats: {
                    messages: {},
                    dictionaries: {}
                },

                async init() {
                    await this.refreshStats();
                },

                async refreshStats() {
                    this.loading = true;
                    try {
                        // Fetch messages stats
                        const messagesRes = await fetch('/api/messages/stats');
                        if (messagesRes.ok) {
                            this.stats.messages = await messagesRes.json();
                        }

                        // Fetch dictionary stats
                        const dictRes = await fetch('/api/dictionary/stats');
                        if (dictRes.ok) {
                            this.stats.dictionaries = await dictRes.json();
                        }
                    } catch (error) {
                        console.error('Error fetching stats:', error);
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }
    </script>
</body>
</html>
